{{ if (and (.backup) (eq .chezmoi.os "linux")) -}}
#!/bin/bash

# The path to the file we want to check
file="$HOME/.hetznerenv"

# Function to check if the file contains a non-empty HETZNER_ACCOUNT_NUMBER assignment
check_content() {
    grep -Eq "^HETZNER_ACCOUNT_NUMBER=.*$" "$file"
}

# Check if the file exists
if [ -f "$file" ]; then
    echo "The file $file exists."

    # Check if the file contains a HETZNER_ACCOUNT_NUMBER assignment with any value
    if check_content; then
        echo "The file contains a HETZNER_ACCOUNT_NUMBER assignment."
    else
        echo "The file does not contain a HETZNER_ACCOUNT_NUMBER assignment."
        echo "Please add a line to the file with the following format:"
        echo "HETZNER_ACCOUNT_NUMBER=<your_value_here>"
        exit 1  # Exit with status code 1 indicating failure due to missing assignment
    fi
else
    echo "The file $file does not exist."
    echo "Please create the file $file and add a line with the following format:"
    echo "HETZNER_ACCOUNT_NUMBER=<your_value_here>"
    exit 1  # Exit with status code 1 indicating failure due to missing file
fi

# If you want to automatically source the file when it exists and has any HETZNER_ACCOUNT_NUMBER assignment
if [ -f "$file" ] && check_content; then
    set -a; source "$file"; set +a
    echo "The environment variables from $file have been sourced."
else
    # This else block is technically not necessary due to the exit calls above
    # but is included for clarity and completeness.
    exit 1  # Provide an additional exit point for clarity, though not reached due to the exits above.
fi

ansible-playbook ~/.playbooks/setup_borg.yml
{{ end }}
